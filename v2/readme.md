# 动态均衡策略

这是一个基于动态资产配置平衡的加密货币交易策略，专为ETH/USDT交易对设计。该策略旨在通过统计套利和资产再平衡原理，在市场波动中获取收益。

## 策略概述

动态均衡策略是一种市场中性策略，通过维持投资组合中ETH和USDT的固定比例（默认50%）来获取收益。策略利用价格波动检测机制识别异常价格波动，并在波动方向上进行交易，同时通过定期再平衡确保投资组合风险敞口保持在目标水平。

## 核心机制

### 1. 资产配置再平衡

策略维持ETH和USDT的固定比例（默认50%/50%）：

- 当ETH持仓比例低于48%时，自动买入ETH
- 当ETH持仓比例高于52%时，自动卖出ETH
- 每次再平衡交易量不超过账户资金的1%
- 单笔交易最小规模为0.001 ETH

### 2. 波动检测交易

策略通过统计方法检测价格异常波动：

- 使用20个周期的简单移动平均线（SMA）作为基准价格
- 计算价格的标准差（SD）以衡量正常波动范围
- 当价格偏离SMA超过2个标准差时，触发交易信号
- 交易量根据当前波动幅度和交易量加权调整

### 3. 风险管理

策略内置多种风险控制机制：

- 止损机制：当持仓亏损超过5%时自动平仓
- 最大持仓限制：单笔交易最大持仓不超过0.1 ETH
- 动态交易量调整：根据市场交易量调整交易规模

## 策略参数

| 参数名 | 默认值 | 描述 |
|--------|--------|------|
| symbol | ETHUSDT | 交易对 |
| initial_usdt | 10000 | 初始USDT余额 |
| initial_eth | 0 | 初始ETH余额 |
| target_ratio | 0.5 | 目标ETH持仓比例 |
| balance_threshold | 0.02 | 再平衡触发阈值（±2%） |
| burst_threshold | 2 | 波动检测阈值（2个标准差） |
| min_trade_amount | 0.001 | 最小交易量（ETH） |
| max_position | 0.1 | 最大持仓量（ETH） |
| stop_loss | 0.05 | 止损阈值（5%） |
| volume_lookback | 10 | 成交量计算回看周期 |
| price_lookback | 20 | 价格波动计算回看周期 |
| fee_rate | 0.001 | 手续费率（0.1%） |

## 交易逻辑详解

### 初始化阶段
1. 设置初始资金（10000 USDT）
2. 初始化价格和交易量历史数据
3. 设置目标资产配置比例（50% ETH, 50% USDT）

### 每个时间周期执行流程
1. 更新交易量和价格数据
2. 执行资产配置再平衡检查
3. 检查并执行止损
4. 计算价格移动平均线和标准差
5. 检测价格异常波动并执行交易
6. 记录当前净值

### 资产配置再平衡
- 计算当前ETH价值占总资产的比例
- 如果比例偏离目标±2%，则执行再平衡交易
- 买入时使用市场买一价，卖出时使用市场卖一价

### 波动检测交易
- 当价格高于移动平均线+2个标准差时，买入ETH
- 当价格低于移动平均线-2个标准差时，卖出ETH
- 交易量根据以下因素动态调整：
  - 可用资金或持仓量
  - 当前市场交易量（交易量越高，交易量越大）
  - 策略启动初期减少交易量（前10个周期降低20%）

## 回测性能指标

回测结束后会输出以下性能指标：
- 初始投资组合价值
- 最终投资组合价值
- 总收益/损失
- 总交易次数
- 胜率（盈利交易占比）
- 最大回撤

## 策略优势

1. **市场中性**：不依赖于对市场方向的预测，适用于各种市场环境
2. **风险控制**：通过资产配置再平衡和止损机制控制风险
3. **动态调整**：根据市场波动性和交易量动态调整交易规模
4. **统计套利**：利用价格波动的均值回归特性获取收益

## 策略局限性

1. **交易成本**：频繁交易会产生手续费成本，可能侵蚀收益
2. **滑点风险**：实际成交价格可能与策略价格存在偏差
3. **数据依赖**：策略效果高度依赖于历史数据的质量和代表性
4. **市场极端情况**：在市场出现极端行情时可能失效

## 使用说明

要运行回测，请执行：
```bash
python backtest.py
```

确保数据文件`/home/krli/dreams/binance-scalping/data/yahoo_eth_usd_15m.csv`存在且格式正确。